include ../.makefiles

all:
	@echo "Syntax: make <test|prepare|jar|clean>"

test:
	@(make clean v=$(VER))
	@(make prepare v=$(VER))
	(cd $(SRC)/com/qzx/au/$(MOD) ; export CLASSPATH=$(CPCOMMON):$(CP) ; $(JC) $(JFLAGS) *.java)

prepare:
	@mkdir -p $(SRC)/com/qzx/au/$(MOD)
	@(cd src; for j in *.java; do cpp -E -P -DMC$(VER) -o $(SRC)/com/qzx/au/$(MOD)/$$j $$j; done)
	@(cd src; for d in *; do if [ -d "$$d" ]; then mkdir $(SRC)/com/qzx/au/$(MOD)/$$d; for j in $$d/*.java; do cpp -E -P -DMC$(VER) -o $(SRC)/com/qzx/au/$(MOD)/$$j $$j; done; fi; done)

	@../.only_with.sh $(SRC)/com/qzx/au/$(MOD) $(VER)

ifdef DEBUG
	@(cp ../Debug.java $(SRC)/com/qzx/au/$(MOD)/)
	@(sed -E -i "s:MOD_LOWER:$(MOD):" $(SRC)/com/qzx/au/$(MOD)/Debug.java)
	@(sed -E -i "s:MOD_UPPER:$(MODUPPER):" $(SRC)/com/qzx/au/$(MOD)/Debug.java)
endif

	@(cp _mcmod.info mcmod.info)
	@(sed -E -i "s: modVersion = \"0.0.0\": modVersion = \"$(VER)-$(NOW)\":" $(SRC)/com/qzx/au/$(MOD)/$(AUMOD).java)
	@(sed -E -i "s:\"version\"\: \"0.0.0\":\"version\"\: \"$(VER)-$(NOW)\":" mcmod.info)
	@(sed -E -i "s:\"mcversion\"\: \"0.0.0\":\"mcversion\"\: \"$(DOTVER)\":" mcmod.info)

clean:
	rm -f au_$(MOD)-*.zip
	rm -rf mcmod.info com mods assets
